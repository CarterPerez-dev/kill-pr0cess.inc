# Clean development Dockerfile for SolidJS frontend with vite-plugin-solid patch.
# I'm creating a straightforward development environment that applies the necessary patches without complex scripting.

FROM node:20-alpine

# I'm installing essential development dependencies
RUN apk add --no-cache \
    git \
    curl \
    python3 \
    make \
    g++ \
    && rm -rf /var/cache/apk/*

# I'm creating a non-root user for security
RUN addgroup -g 1001 -S nodejs && \
    adduser -S frontend -u 1001 -G nodejs

RUN mkdir -p /app && chown frontend:nodejs /app

USER frontend
WORKDIR /app

# I'm copying package files for dependency installation
COPY --chown=frontend:nodejs package*.json ./

# I'm installing dependencies
RUN npm ci --legacy-peer-deps || npm install --legacy-peer-deps

# I'm copying and applying the vite plugin patch
COPY --chown=frontend:nodejs vite-plugin-solid-patch.js ./
RUN node vite-plugin-solid-patch.js

# I'm setting development environment variables
ENV NODE_ENV=development
ENV VITE_DEV_MODE=true
ENV VITE_API_URL=http://localhost:3001

# I'm exposing the development server port
EXPOSE 3000

# I'm starting the development server
CMD ["npm", "run", "dev"]
