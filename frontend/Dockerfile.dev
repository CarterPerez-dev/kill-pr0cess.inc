FROM node:20-alpine

# I'm installing development tools and utilities
RUN apk add --no-cache \
    git \
    curl \
    && rm -rf /var/cache/apk/*


WORKDIR /app

# I'm copying package files for dependency installation
COPY --chown=developer:nodejs package*.json ./

# I'm installing all dependencies including dev dependencies
RUN npm ci --legacy-peer-deps || npm install --legacy-peer-deps

# I'm applying a patch for vite-plugin-solid
COPY --chown=developer:nodejs vite-plugin-solid-patch.js ./
RUN node vite-plugin-solid-patch.js

# I'm setting development environment variables
ENV NODE_ENV=development
ENV VITE_DEV_MODE=true
ENV VITE_API_URL=http://localhost:3001

# I'm exposing the development server port
EXPOSE 3000

# I'm starting the development server with hot reload
CMD ["npm", "run", "dev"]
